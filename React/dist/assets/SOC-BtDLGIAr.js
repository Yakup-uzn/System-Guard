import{a as z,j as i,y as f}from"./index-Be5gV0GW.js";import{r as _,k as G,l as K}from"./icons-DvRqANnr.js";import"./react-Csw2ODfV.js";import"./firebase-Bvu3lIf5.js";function J(h,e){h.terminate=function(){const t=()=>{};this.onerror=t,this.onmessage=t,this.onopen=t;const s=new Date,o=Math.random().toString().substring(2,8),c=this.onclose;this.onclose=u=>{const l=new Date().getTime()-s.getTime();e(`Discarded socket (#${o})  closed after ${l}ms, with code/reason: ${u.code}/${u.reason}`)},this.close(),c==null||c.call(h,{code:4001,reason:`Quick discarding socket (#${o}) without waiting for the shutdown sequence.`,wasClean:!1})}}const x={LF:`
`,NULL:"\0"};class C{get body(){return!this._body&&this.isBinaryBody&&(this._body=new TextDecoder().decode(this._binaryBody)),this._body||""}get binaryBody(){return!this._binaryBody&&!this.isBinaryBody&&(this._binaryBody=new TextEncoder().encode(this._body)),this._binaryBody}constructor(e){const{command:t,headers:s,body:o,binaryBody:c,escapeHeaderValues:u,skipContentLengthHeader:l}=e;this.command=t,this.headers=Object.assign({},s||{}),c?(this._binaryBody=c,this.isBinaryBody=!0):(this._body=o||"",this.isBinaryBody=!1),this.escapeHeaderValues=u||!1,this.skipContentLengthHeader=l||!1}static fromRawFrame(e,t){const s={},o=c=>c.replace(/^\s+|\s+$/g,"");for(const c of e.headers.reverse()){c.indexOf(":");const u=o(c[0]);let l=o(c[1]);t&&e.command!=="CONNECT"&&e.command!=="CONNECTED"&&(l=C.hdrValueUnEscape(l)),s[u]=l}return new C({command:e.command,headers:s,binaryBody:e.binaryBody,escapeHeaderValues:t})}toString(){return this.serializeCmdAndHeaders()}serialize(){const e=this.serializeCmdAndHeaders();return this.isBinaryBody?C.toUnit8Array(e,this._binaryBody).buffer:e+this._body+x.NULL}serializeCmdAndHeaders(){const e=[this.command];this.skipContentLengthHeader&&delete this.headers["content-length"];for(const t of Object.keys(this.headers||{})){const s=this.headers[t];this.escapeHeaderValues&&this.command!=="CONNECT"&&this.command!=="CONNECTED"?e.push(`${t}:${C.hdrValueEscape(`${s}`)}`):e.push(`${t}:${s}`)}return(this.isBinaryBody||!this.isBodyEmpty()&&!this.skipContentLengthHeader)&&e.push(`content-length:${this.bodyLength()}`),e.join(x.LF)+x.LF+x.LF}isBodyEmpty(){return this.bodyLength()===0}bodyLength(){const e=this.binaryBody;return e?e.length:0}static sizeOfUTF8(e){return e?new TextEncoder().encode(e).length:0}static toUnit8Array(e,t){const s=new TextEncoder().encode(e),o=new Uint8Array([0]),c=new Uint8Array(s.length+t.length+o.length);return c.set(s),c.set(t,s.length),c.set(o,s.length+t.length),c}static marshall(e){return new C(e).serialize()}static hdrValueEscape(e){return e.replace(/\\/g,"\\\\").replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/:/g,"\\c")}static hdrValueUnEscape(e){return e.replace(/\\r/g,"\r").replace(/\\n/g,`
`).replace(/\\c/g,":").replace(/\\\\/g,"\\")}}const H=0,E=10,I=13,Y=58;class X{constructor(e,t){this.onFrame=e,this.onIncomingPing=t,this._encoder=new TextEncoder,this._decoder=new TextDecoder,this._token=[],this._initState()}parseChunk(e,t=!1){let s;if(typeof e=="string"?s=this._encoder.encode(e):s=new Uint8Array(e),t&&s[s.length-1]!==0){const o=new Uint8Array(s.length+1);o.set(s,0),o[s.length]=0,s=o}for(let o=0;o<s.length;o++){const c=s[o];this._onByte(c)}}_collectFrame(e){if(e!==H&&e!==I){if(e===E){this.onIncomingPing();return}this._onByte=this._collectCommand,this._reinjectByte(e)}}_collectCommand(e){if(e!==I){if(e===E){this._results.command=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_collectHeaders(e){if(e!==I){if(e===E){this._setupCollectBody();return}this._onByte=this._collectHeaderKey,this._reinjectByte(e)}}_reinjectByte(e){this._onByte(e)}_collectHeaderKey(e){if(e===Y){this._headerKey=this._consumeTokenAsUTF8(),this._onByte=this._collectHeaderValue;return}this._consumeByte(e)}_collectHeaderValue(e){if(e!==I){if(e===E){this._results.headers.push([this._headerKey,this._consumeTokenAsUTF8()]),this._headerKey=void 0,this._onByte=this._collectHeaders;return}this._consumeByte(e)}}_setupCollectBody(){const e=this._results.headers.filter(t=>t[0]==="content-length")[0];e?(this._bodyBytesRemaining=parseInt(e[1],10),this._onByte=this._collectBodyFixedSize):this._onByte=this._collectBodyNullTerminated}_collectBodyNullTerminated(e){if(e===H){this._retrievedBody();return}this._consumeByte(e)}_collectBodyFixedSize(e){if(this._bodyBytesRemaining--===0){this._retrievedBody();return}this._consumeByte(e)}_retrievedBody(){this._results.binaryBody=this._consumeTokenAsRaw();try{this.onFrame(this._results)}catch(e){console.log("Ignoring an exception thrown by a frame handler. Original exception: ",e)}this._initState()}_consumeByte(e){this._token.push(e)}_consumeTokenAsUTF8(){return this._decoder.decode(this._consumeTokenAsRaw())}_consumeTokenAsRaw(){const e=new Uint8Array(this._token);return this._token=[],e}_initState(){this._results={command:void 0,headers:[],binaryBody:void 0},this._token=[],this._headerKey=void 0,this._onByte=this._collectFrame}}var S;(function(h){h[h.CONNECTING=0]="CONNECTING",h[h.OPEN=1]="OPEN",h[h.CLOSING=2]="CLOSING",h[h.CLOSED=3]="CLOSED"})(S||(S={}));var y;(function(h){h[h.ACTIVE=0]="ACTIVE",h[h.DEACTIVATING=1]="DEACTIVATING",h[h.INACTIVE=2]="INACTIVE"})(y||(y={}));var j;(function(h){h[h.LINEAR=0]="LINEAR",h[h.EXPONENTIAL=1]="EXPONENTIAL"})(j||(j={}));var v;(function(h){h.Interval="interval",h.Worker="worker"})(v||(v={}));class q{constructor(e,t=v.Interval,s){this._interval=e,this._strategy=t,this._debug=s,this._workerScript=`
    var startTime = Date.now();
    setInterval(function() {
        self.postMessage(Date.now() - startTime);
    }, ${this._interval});
  `}start(e){this.stop(),this.shouldUseWorker()?this.runWorker(e):this.runInterval(e)}stop(){this.disposeWorker(),this.disposeInterval()}shouldUseWorker(){return typeof Worker<"u"&&this._strategy===v.Worker}runWorker(e){this._debug("Using runWorker for outgoing pings"),this._worker||(this._worker=new Worker(URL.createObjectURL(new Blob([this._workerScript],{type:"text/javascript"}))),this._worker.onmessage=t=>e(t.data))}runInterval(e){if(this._debug("Using runInterval for outgoing pings"),!this._timer){const t=Date.now();this._timer=setInterval(()=>{e(Date.now()-t)},this._interval)}}disposeWorker(){this._worker&&(this._worker.terminate(),delete this._worker,this._debug("Outgoing ping disposeWorker"))}disposeInterval(){this._timer&&(clearInterval(this._timer),delete this._timer,this._debug("Outgoing ping disposeInterval"))}}class p{constructor(e){this.versions=e}supportedVersions(){return this.versions.join(",")}protocolVersions(){return this.versions.map(e=>`v${e.replace(".","")}.stomp`)}}p.V1_0="1.0";p.V1_1="1.1";p.V1_2="1.2";p.default=new p([p.V1_2,p.V1_1,p.V1_0]);class Q{get connectedVersion(){return this._connectedVersion}get connected(){return this._connected}constructor(e,t,s){this._client=e,this._webSocket=t,this._connected=!1,this._serverFrameHandlers={CONNECTED:o=>{this.debug(`connected to server ${o.headers.server}`),this._connected=!0,this._connectedVersion=o.headers.version,this._connectedVersion===p.V1_2&&(this._escapeHeaderValues=!0),this._setupHeartbeat(o.headers),this.onConnect(o)},MESSAGE:o=>{const c=o.headers.subscription,u=this._subscriptions[c]||this.onUnhandledMessage,l=o,g=this,b=this._connectedVersion===p.V1_2?l.headers.ack:l.headers["message-id"];l.ack=(k={})=>g.ack(b,c,k),l.nack=(k={})=>g.nack(b,c,k),u(l)},RECEIPT:o=>{const c=this._receiptWatchers[o.headers["receipt-id"]];c?(c(o),delete this._receiptWatchers[o.headers["receipt-id"]]):this.onUnhandledReceipt(o)},ERROR:o=>{this.onStompError(o)}},this._counter=0,this._subscriptions={},this._receiptWatchers={},this._partialData="",this._escapeHeaderValues=!1,this._lastServerActivityTS=Date.now(),this.debug=s.debug,this.stompVersions=s.stompVersions,this.connectHeaders=s.connectHeaders,this.disconnectHeaders=s.disconnectHeaders,this.heartbeatIncoming=s.heartbeatIncoming,this.heartbeatOutgoing=s.heartbeatOutgoing,this.splitLargeFrames=s.splitLargeFrames,this.maxWebSocketChunkSize=s.maxWebSocketChunkSize,this.forceBinaryWSFrames=s.forceBinaryWSFrames,this.logRawCommunication=s.logRawCommunication,this.appendMissingNULLonIncoming=s.appendMissingNULLonIncoming,this.discardWebsocketOnCommFailure=s.discardWebsocketOnCommFailure,this.onConnect=s.onConnect,this.onDisconnect=s.onDisconnect,this.onStompError=s.onStompError,this.onWebSocketClose=s.onWebSocketClose,this.onWebSocketError=s.onWebSocketError,this.onUnhandledMessage=s.onUnhandledMessage,this.onUnhandledReceipt=s.onUnhandledReceipt,this.onUnhandledFrame=s.onUnhandledFrame}start(){const e=new X(t=>{const s=C.fromRawFrame(t,this._escapeHeaderValues);this.logRawCommunication||this.debug(`<<< ${s}`),(this._serverFrameHandlers[s.command]||this.onUnhandledFrame)(s)},()=>{this.debug("<<< PONG")});this._webSocket.onmessage=t=>{if(this.debug("Received data"),this._lastServerActivityTS=Date.now(),this.logRawCommunication){const s=t.data instanceof ArrayBuffer?new TextDecoder().decode(t.data):t.data;this.debug(`<<< ${s}`)}e.parseChunk(t.data,this.appendMissingNULLonIncoming)},this._webSocket.onclose=t=>{this.debug(`Connection closed to ${this._webSocket.url}`),this._cleanUp(),this.onWebSocketClose(t)},this._webSocket.onerror=t=>{this.onWebSocketError(t)},this._webSocket.onopen=()=>{const t=Object.assign({},this.connectHeaders);this.debug("Web Socket Opened..."),t["accept-version"]=this.stompVersions.supportedVersions(),t["heart-beat"]=[this.heartbeatOutgoing,this.heartbeatIncoming].join(","),this._transmit({command:"CONNECT",headers:t})}}_setupHeartbeat(e){if(e.version!==p.V1_1&&e.version!==p.V1_2||!e["heart-beat"])return;const[t,s]=e["heart-beat"].split(",").map(o=>parseInt(o,10));if(this.heartbeatOutgoing!==0&&s!==0){const o=Math.max(this.heartbeatOutgoing,s);this.debug(`send PING every ${o}ms`),this._pinger=new q(o,this._client.heartbeatStrategy,this.debug),this._pinger.start(()=>{this._webSocket.readyState===S.OPEN&&(this._webSocket.send(x.LF),this.debug(">>> PING"))})}if(this.heartbeatIncoming!==0&&t!==0){const o=Math.max(this.heartbeatIncoming,t);this.debug(`check PONG every ${o}ms`),this._ponger=setInterval(()=>{const c=Date.now()-this._lastServerActivityTS;c>o*2&&(this.debug(`did not receive server activity for the last ${c}ms`),this._closeOrDiscardWebsocket())},o)}}_closeOrDiscardWebsocket(){this.discardWebsocketOnCommFailure?(this.debug("Discarding websocket, the underlying socket may linger for a while"),this.discardWebsocket()):(this.debug("Issuing close on the websocket"),this._closeWebsocket())}forceDisconnect(){this._webSocket&&(this._webSocket.readyState===S.CONNECTING||this._webSocket.readyState===S.OPEN)&&this._closeOrDiscardWebsocket()}_closeWebsocket(){this._webSocket.onmessage=()=>{},this._webSocket.close()}discardWebsocket(){typeof this._webSocket.terminate!="function"&&J(this._webSocket,e=>this.debug(e)),this._webSocket.terminate()}_transmit(e){const{command:t,headers:s,body:o,binaryBody:c,skipContentLengthHeader:u}=e,l=new C({command:t,headers:s,body:o,binaryBody:c,escapeHeaderValues:this._escapeHeaderValues,skipContentLengthHeader:u});let g=l.serialize();if(this.logRawCommunication?this.debug(`>>> ${g}`):this.debug(`>>> ${l}`),this.forceBinaryWSFrames&&typeof g=="string"&&(g=new TextEncoder().encode(g)),typeof g!="string"||!this.splitLargeFrames)this._webSocket.send(g);else{let b=g;for(;b.length>0;){const k=b.substring(0,this.maxWebSocketChunkSize);b=b.substring(this.maxWebSocketChunkSize),this._webSocket.send(k),this.debug(`chunk sent = ${k.length}, remaining = ${b.length}`)}}}dispose(){if(this.connected)try{const e=Object.assign({},this.disconnectHeaders);e.receipt||(e.receipt=`close-${this._counter++}`),this.watchForReceipt(e.receipt,t=>{this._closeWebsocket(),this._cleanUp(),this.onDisconnect(t)}),this._transmit({command:"DISCONNECT",headers:e})}catch(e){this.debug(`Ignoring error during disconnect ${e}`)}else(this._webSocket.readyState===S.CONNECTING||this._webSocket.readyState===S.OPEN)&&this._closeWebsocket()}_cleanUp(){this._connected=!1,this._pinger&&(this._pinger.stop(),this._pinger=void 0),this._ponger&&(clearInterval(this._ponger),this._ponger=void 0)}publish(e){const{destination:t,headers:s,body:o,binaryBody:c,skipContentLengthHeader:u}=e,l=Object.assign({destination:t},s);this._transmit({command:"SEND",headers:l,body:o,binaryBody:c,skipContentLengthHeader:u})}watchForReceipt(e,t){this._receiptWatchers[e]=t}subscribe(e,t,s={}){s=Object.assign({},s),s.id||(s.id=`sub-${this._counter++}`),s.destination=e,this._subscriptions[s.id]=t,this._transmit({command:"SUBSCRIBE",headers:s});const o=this;return{id:s.id,unsubscribe(c){return o.unsubscribe(s.id,c)}}}unsubscribe(e,t={}){t=Object.assign({},t),delete this._subscriptions[e],t.id=e,this._transmit({command:"UNSUBSCRIBE",headers:t})}begin(e){const t=e||`tx-${this._counter++}`;this._transmit({command:"BEGIN",headers:{transaction:t}});const s=this;return{id:t,commit(){s.commit(t)},abort(){s.abort(t)}}}commit(e){this._transmit({command:"COMMIT",headers:{transaction:e}})}abort(e){this._transmit({command:"ABORT",headers:{transaction:e}})}ack(e,t,s={}){s=Object.assign({},s),this._connectedVersion===p.V1_2?s.id=e:s["message-id"]=e,s.subscription=t,this._transmit({command:"ACK",headers:s})}nack(e,t,s={}){return s=Object.assign({},s),this._connectedVersion===p.V1_2?s.id=e:s["message-id"]=e,s.subscription=t,this._transmit({command:"NACK",headers:s})}}class Z{get webSocket(){var e;return(e=this._stompHandler)==null?void 0:e._webSocket}get disconnectHeaders(){return this._disconnectHeaders}set disconnectHeaders(e){this._disconnectHeaders=e,this._stompHandler&&(this._stompHandler.disconnectHeaders=this._disconnectHeaders)}get connected(){return!!this._stompHandler&&this._stompHandler.connected}get connectedVersion(){return this._stompHandler?this._stompHandler.connectedVersion:void 0}get active(){return this.state===y.ACTIVE}_changeState(e){this.state=e,this.onChangeState(e)}constructor(e={}){this.stompVersions=p.default,this.connectionTimeout=0,this.reconnectDelay=5e3,this._nextReconnectDelay=0,this.maxReconnectDelay=15*60*1e3,this.reconnectTimeMode=j.LINEAR,this.heartbeatIncoming=1e4,this.heartbeatOutgoing=1e4,this.heartbeatStrategy=v.Interval,this.splitLargeFrames=!1,this.maxWebSocketChunkSize=8*1024,this.forceBinaryWSFrames=!1,this.appendMissingNULLonIncoming=!1,this.discardWebsocketOnCommFailure=!1,this.state=y.INACTIVE;const t=()=>{};this.debug=t,this.beforeConnect=t,this.onConnect=t,this.onDisconnect=t,this.onUnhandledMessage=t,this.onUnhandledReceipt=t,this.onUnhandledFrame=t,this.onStompError=t,this.onWebSocketClose=t,this.onWebSocketError=t,this.logRawCommunication=!1,this.onChangeState=t,this.connectHeaders={},this._disconnectHeaders={},this.configure(e)}configure(e){Object.assign(this,e),this.maxReconnectDelay>0&&this.maxReconnectDelay<this.reconnectDelay&&(this.debug(`Warning: maxReconnectDelay (${this.maxReconnectDelay}ms) is less than reconnectDelay (${this.reconnectDelay}ms). Using reconnectDelay as the maxReconnectDelay delay.`),this.maxReconnectDelay=this.reconnectDelay)}activate(){const e=()=>{if(this.active){this.debug("Already ACTIVE, ignoring request to activate");return}this._changeState(y.ACTIVE),this._nextReconnectDelay=this.reconnectDelay,this._connect()};this.state===y.DEACTIVATING?(this.debug("Waiting for deactivation to finish before activating"),this.deactivate().then(()=>{e()})):e()}async _connect(){if(await this.beforeConnect(this),this._stompHandler){this.debug("There is already a stompHandler, skipping the call to connect");return}if(!this.active){this.debug("Client has been marked inactive, will not attempt to connect");return}this.connectionTimeout>0&&(this._connectionWatcher&&clearTimeout(this._connectionWatcher),this._connectionWatcher=setTimeout(()=>{this.connected||(this.debug(`Connection not established in ${this.connectionTimeout}ms, closing socket`),this.forceDisconnect())},this.connectionTimeout)),this.debug("Opening Web Socket...");const e=this._createWebSocket();this._stompHandler=new Q(this,e,{debug:this.debug,stompVersions:this.stompVersions,connectHeaders:this.connectHeaders,disconnectHeaders:this._disconnectHeaders,heartbeatIncoming:this.heartbeatIncoming,heartbeatOutgoing:this.heartbeatOutgoing,heartbeatStrategy:this.heartbeatStrategy,splitLargeFrames:this.splitLargeFrames,maxWebSocketChunkSize:this.maxWebSocketChunkSize,forceBinaryWSFrames:this.forceBinaryWSFrames,logRawCommunication:this.logRawCommunication,appendMissingNULLonIncoming:this.appendMissingNULLonIncoming,discardWebsocketOnCommFailure:this.discardWebsocketOnCommFailure,onConnect:t=>{if(this._connectionWatcher&&(clearTimeout(this._connectionWatcher),this._connectionWatcher=void 0),!this.active){this.debug("STOMP got connected while deactivate was issued, will disconnect now"),this._disposeStompHandler();return}this.onConnect(t)},onDisconnect:t=>{this.onDisconnect(t)},onStompError:t=>{this.onStompError(t)},onWebSocketClose:t=>{this._stompHandler=void 0,this.state===y.DEACTIVATING&&this._changeState(y.INACTIVE),this.onWebSocketClose(t),this.active&&this._schedule_reconnect()},onWebSocketError:t=>{this.onWebSocketError(t)},onUnhandledMessage:t=>{this.onUnhandledMessage(t)},onUnhandledReceipt:t=>{this.onUnhandledReceipt(t)},onUnhandledFrame:t=>{this.onUnhandledFrame(t)}}),this._stompHandler.start()}_createWebSocket(){let e;if(this.webSocketFactory)e=this.webSocketFactory();else if(this.brokerURL)e=new WebSocket(this.brokerURL,this.stompVersions.protocolVersions());else throw new Error("Either brokerURL or webSocketFactory must be provided");return e.binaryType="arraybuffer",e}_schedule_reconnect(){this._nextReconnectDelay>0&&(this.debug(`STOMP: scheduling reconnection in ${this._nextReconnectDelay}ms`),this._reconnector=setTimeout(()=>{this.reconnectTimeMode===j.EXPONENTIAL&&(this._nextReconnectDelay=this._nextReconnectDelay*2,this.maxReconnectDelay!==0&&(this._nextReconnectDelay=Math.min(this._nextReconnectDelay,this.maxReconnectDelay))),this._connect()},this._nextReconnectDelay))}async deactivate(e={}){var c;const t=e.force||!1,s=this.active;let o;if(this.state===y.INACTIVE)return this.debug("Already INACTIVE, nothing more to do"),Promise.resolve();if(this._changeState(y.DEACTIVATING),this._nextReconnectDelay=0,this._reconnector&&(clearTimeout(this._reconnector),this._reconnector=void 0),this._stompHandler&&this.webSocket.readyState!==S.CLOSED){const u=this._stompHandler.onWebSocketClose;o=new Promise((l,g)=>{this._stompHandler.onWebSocketClose=b=>{u(b),l()}})}else return this._changeState(y.INACTIVE),Promise.resolve();return t?(c=this._stompHandler)==null||c.discardWebsocket():s&&this._disposeStompHandler(),o}forceDisconnect(){this._stompHandler&&this._stompHandler.forceDisconnect()}_disposeStompHandler(){this._stompHandler&&this._stompHandler.dispose()}publish(e){this._checkConnection(),this._stompHandler.publish(e)}_checkConnection(){if(!this.connected)throw new TypeError("There is no underlying STOMP connection")}watchForReceipt(e,t){this._checkConnection(),this._stompHandler.watchForReceipt(e,t)}subscribe(e,t,s={}){return this._checkConnection(),this._stompHandler.subscribe(e,t,s)}unsubscribe(e,t={}){this._checkConnection(),this._stompHandler.unsubscribe(e,t)}begin(e){return this._checkConnection(),this._stompHandler.begin(e)}commit(e){this._checkConnection(),this._stompHandler.commit(e)}abort(e){this._checkConnection(),this._stompHandler.abort(e)}ack(e,t,s={}){this._checkConnection(),this._stompHandler.ack(e,t,s)}nack(e,t,s={}){this._checkConnection(),this._stompHandler.nack(e,t,s)}}const ie=()=>{const[h,e]=_.useState([]),[t,s]=_.useState(null),[o,c]=_.useState({}),[u,l]=_.useState(""),[g,b]=_.useState(null),[k,B]=_.useState([]),[T,O]=_.useState([]),[D,W]=_.useState(null),[w,A]=_.useState("");_.useEffect(()=>{const n=z.onAuthStateChanged(r=>{r&&A(r.email)});return()=>n()},[]),_.useEffect(()=>{const n=new Z({brokerURL:"ws://localhost:8080/ws-running-update",onConnect:()=>{console.log("🔌 WebSocket bağlantısı kuruldu."),n.subscribe("/topic/running-updates",r=>{const a=JSON.parse(r.body);e(d=>d.map(m=>m.id===a.emailId?{...m,running:a.running,byUser:a.byUser}:m))}),n.subscribe("/topic/email-updates",r=>{const a=JSON.parse(r.body);e(d=>a.action==="CREATE"?[a.email,...d]:a.action==="DELETE"?d.filter(m=>m.id!==a.email.id):d)})},onStompError:r=>{console.error("STOMP error:",r)}});return n.activate(),()=>{n.deactivate()}},[]),_.useEffect(()=>{fetch("http://localhost:8080/api/emails").then(n=>{if(!n.ok)throw new Error(`HTTP hata: ${n.status}`);return n.json()}).then(e).catch(console.error)},[]),_.useEffect(()=>{const n=()=>{w&&fetch(`http://localhost:8080/api/emails/close-by-user?byUser=${encodeURIComponent(w)}`,{method:"POST",keepalive:!0})};return window.addEventListener("beforeunload",n),()=>window.removeEventListener("beforeunload",n)},[w]);const U=async n=>{if(n)try{const r=await fetch(`http://localhost:8080/api/ip-check/${n}`);if(!r.ok)return;const a=await r.json();c(d=>({...d,[n]:a}))}catch(r){console.error("IP sorgulama hatası:",r)}},L=async n=>{try{if(!(await fetch(`http://localhost:8080/api/emails/${n}`,{method:"DELETE"})).ok)throw new Error("Silme işlemi başarısız");e(a=>a.filter(d=>d.id!==n)),f.success("✅ Mail başarıyla silindi!")}catch(r){console.error("Silme hatası:",r),f.error("❌ Mail silinemedi.")}},R=async n=>{const r=prompt("Yönlendirme notunuzu giriniz:","SOC tarafından bildirilen olayı iletiyorum. İnceleyiniz.");if(!r){f.warning("Yorum girilmediği için yönlendirme iptal edildi.");return}const a={messageId:n.messageId,comment:r};try{(await fetch("http://localhost:8080/api/forward",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok?f.success("📤 Mail başarıyla yönlendirildi."):f.error("❌ Mail yönlendirme başarısız oldu.")}catch(d){console.error("Forward hatası:",d),f.error("⚠️ Bir hata oluştu.")}},V=n=>{B(r=>r.includes(n)?r.filter(a=>a!==n):[...r,n])},F=n=>{b(r=>r===n?null:n)},$=async(n,r)=>{const a=t!==n,d=D;if(s(a?n:null),a&&W(n),a&&r&&!o[r]&&await U(r),d&&d!==n&&w)try{await fetch(`http://localhost:8080/api/emails/${d}/running?running=0&byUser=${w}`,{method:"PATCH"})}catch(m){console.error("Önceki accordion running sıfırlama hatası:",m)}if(w)try{await fetch(`http://localhost:8080/api/emails/${n}/running?running=${a?1:0}&byUser=${w}`,{method:"PATCH"})}catch(m){console.error("Running güncelleme hatası:",m)}e(m=>m.map(N=>N.id===n?{...N,running:a?1:0}:N.id===d?{...N,running:0}:N))},P=h.filter(n=>n.subject&&n.subject.toLowerCase().includes(u.toLowerCase())),M=async(n,r)=>{const a=T.includes(r);try{if(a){if(!(await fetch(`http://localhost:8080/api/ips/unblock?ipAddress=${r}`,{method:"PATCH"})).ok)return;f.info("🟢 IP engeli kaldırıldı.")}else{const d=await fetch("http://localhost:8080/api/ips/block",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ipAddress:n.ipAddress||r,isp:n.isp,abuseScore:n.abuseConfidenceScore,countryCode:n.countryCode,domain:n.domain})});d.status===409?f.warning("⚠️ Bu IP zaten engellenmiş!"):d.ok&&f.success("🚫 IP başarıyla engellendi!")}}catch(d){f.error("❌ IP engelleme hatası!"),console.error("IP engelleme hatası:",d)}};return i.jsxs("div",{className:"soc-container",children:[i.jsxs("div",{className:"soc-header-row",children:[i.jsx("h2",{children:"SOC Güvenlik Olayları"}),i.jsx("input",{type:"text",className:"soc-filter-input",placeholder:"Subject ile filtrele...",value:u,onChange:n=>l(n.target.value)})]}),P.map(n=>{const r=n.offenseSource,a=r?o[r]:null,d=k.includes(n.id);return i.jsxs("div",{className:`soc-card 
          ${n.running===1&&t===n.id?"running-self":""}
          ${n.running===1&&t!==n.id?"running-foreign":""}
        `,children:[n.running===1&&n.byUser&&i.jsx("div",{className:"running-user-divider",children:n.byUser}),i.jsxs("div",{className:"soc-summary",onClick:()=>$(n.id,r),children:[i.jsx("div",{className:"soc-avatar",children:n.senderName?n.senderName.charAt(0):"?"}),i.jsxs("div",{className:"soc-header-content",children:[i.jsxs("span",{className:"soc-subject",children:[d&&i.jsx(G,{className:"soc-flag-icon"})," ",n.subject||"Konu Yok"]}),i.jsx("span",{className:"soc-alert",children:n.alertName||"Bilinmeyen Uyarı"})]}),i.jsxs("div",{className:"soc-menu-wrapper",onClick:m=>m.stopPropagation(),children:[i.jsx(K,{className:"soc-menu-icon",onClick:()=>F(n.id)}),g===n.id&&i.jsxs("div",{className:"soc-dropdown",children:[i.jsx("div",{onClick:()=>V(n.id),children:d?"🚫 Bayrağı Kaldır":"📌 Bayrak Ekle"}),i.jsx("div",{onClick:()=>L(n.id),children:"✅ Solved"}),i.jsx("div",{onClick:()=>R(n),children:"📤 Forward"})]})]})]}),t===n.id&&n.running===1&&i.jsxs("div",{className:"soc-details",children:[i.jsxs("div",{className:"soc-section",children:[i.jsx("h4",{children:"📄 Olay Bilgileri"}),i.jsxs("div",{className:"soc-detail-grid",children:[n.alertName&&i.jsxs("div",{className:"soc-detail-item",children:[i.jsx("span",{className:"soc-key",children:"Alert Name: "}),i.jsx("span",{className:"soc-value",children:n.alertName})]}),n.logSource&&i.jsxs("div",{className:"soc-detail-item",children:[i.jsx("span",{className:"soc-key",children:"Log Source: "}),i.jsx("span",{className:"soc-value",children:n.logSource})]}),n.severity&&i.jsxs("div",{className:"soc-detail-item",children:[i.jsx("span",{className:"soc-key",children:"Severity: "}),i.jsx("span",{className:"soc-value",children:n.severity})]}),n.analyst&&i.jsxs("div",{className:"soc-detail-item",children:[i.jsx("span",{className:"soc-key",children:"Analyst: "}),i.jsx("span",{className:"soc-value",children:n.analyst})]}),n.offenseTime&&i.jsxs("div",{className:"soc-detail-item",children:[i.jsx("span",{className:"soc-key",children:"Offense Time: "}),i.jsx("span",{className:"soc-value",children:n.offenseTime})]}),n.offenseSource&&i.jsxs("div",{className:"soc-detail-item",children:[i.jsx("span",{className:"soc-key",children:"Offense Source: "}),i.jsx("span",{className:"soc-value",children:n.offenseSource})]}),n.analystComment&&i.jsxs("div",{className:"soc-detail-item",style:{gridColumn:"1 / -1"},children:[i.jsx("span",{className:"soc-key",children:"Analyst Comment: "}),i.jsx("span",{className:"soc-value",style:{whiteSpace:"pre-wrap"},children:n.analystComment})]})]}),i.jsx("div",{style:{marginTop:"12px"},children:i.jsx("a",{href:n.webLink,target:"_blank",rel:"noopener noreferrer",className:"soc-detail-link-btn",children:"📎 Daha Fazla Detay"})})]}),a&&i.jsxs("div",{className:"soc-section",children:[i.jsx("h4",{children:"🧠 IP Detayları"}),i.jsxs("table",{className:"soc-ip-table",children:[i.jsx("thead",{children:i.jsxs("tr",{children:[i.jsx("th",{children:"abuseConfidenceScore"}),i.jsx("th",{children:"countryCode"}),i.jsx("th",{children:"usageType"}),i.jsx("th",{children:"isp"}),i.jsx("th",{children:"domain"}),i.jsx("th",{style:{textAlign:"center"},children:r})]})}),i.jsx("tbody",{children:i.jsxs("tr",{children:[i.jsxs("td",{children:[i.jsx("span",{className:`dot ${a.abuseConfidenceScore>=70?"red":a.abuseConfidenceScore>=30?"yellow":"green"}`}),a.abuseConfidenceScore]}),i.jsx("td",{children:a.countryCode}),i.jsx("td",{children:a.usageType}),i.jsx("td",{children:a.isp}),i.jsx("td",{children:a.domain}),i.jsx("td",{style:{textAlign:"left"},children:i.jsx("button",{className:`soc-ip-block-btn-inside ${T.includes(r)?"unblock":""}`,onClick:()=>{T.includes(r)?O(m=>m.filter(N=>N!==r)):O(m=>[...m,r]),M(a,r)},children:T.includes(r)?"🟢 Engeli Kaldır":"🚫 IP’yi Engelle"})})]})})]})]}),i.jsxs("div",{className:"soc-section",children:[i.jsx("h4",{children:"🌐 Mail İçeriği"}),i.jsx("iframe",{src:n.formLink,width:"100%",height:"400px",style:{border:"none"}})]})]})]},n.id)})]})};export{ie as default};
